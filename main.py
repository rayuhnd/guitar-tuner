from machine import Pin, PWM
from utime import sleep

# Buzzer and LEDs setup
buzzer = PWM(Pin(16))
buzzer.duty_u16(0)

# Accurate “nyan cat” melody (intro bars)
NOTES = {
    'C0':16,
    'C#0':17,
    'D0':18,
    'D#0':19,
    'E0':21,
    'F0':22,
    'F#0':23,
    'G0':24,
    'G#0':26,
    'A0':28,
    'A#0':29,
    'B0':31,
    'C1':33,
    'C#1':35,
    'D1':37,
    'D#1':39,
    'E1':41,
    'F1':44,
    'F#1':46,
    'G1':49,
    'G#1':52,
    'A1':55,
    'A#1':58,
    'B1':62,
    'C2':65,
    'C#2':69,
    'D2':73,
    'D#2':78,
    'E2':82,
    'F2':87,
    'F#2':92,
    'G2':98,
    'G#2':104,
    'A2':110,
    'A#2':117,
    'B2':123,
    'C3':131,
    'C#3':139,
    'D3':147,
    'D#3':156,
    'E3':165,
    'F3':175,
    'F#3':185,
    'G3':196,
    'G#3':208,
    'A3':220,
    'A#3':233,
    'B3':247,
    'C4':262,
    'C#4':277,
    'D4':294,
    'D#4':311,
    'E4':330,
    'F4':349,
    'F#4':370,
    'G4':392,
    'G#4':415,
    'A4':440,
    'A#4':466,
    'B4':494,
    'C5':523,
    'C#5':554,
    'D5':587,
    'D#5':622,
    'E5':659,
    'F5':698,
    'F#5':740,
    'G5':784,
    'G#5':831,
    'A5':880,
    'A#5':932,
    'B5':988,
    'C6':1047,
    'C#6':1109,
    'D6':1175,
    'D#6':1245,
    'E6':1319,
    'F6':1397,
    'F#6':1480,
    'G6':1568,
    'G#6':1661,
    'A6':1760,
    'A#6':1865,
    'B6':1976,
    'C7':2093,
    'C#7':2217,
    'D7':2349,
    'D#7':2489,
    'E7':2637,
    'F7':2794,
    'F#7':2960,
    'G7':3136,
    'G#7':3322,
    'A7':3520,
    'A#7':3729,
    'B7':3951,
    'C8':4186,
    'C#8':4435,
    'D8':4699,
    'D#8':4978,
    'E8':5274,
    'F8':5588,
    'F#8':5920,
    'G8':6272,
    'G#8':6645,
    'A8':7040,
    'A#8':7459,
    'B8':7902,
    'C9':8372,
    'C#9':8870,
    'D9':9397,
    'D#9':9956,
    'E9':10548,
    'F9':11175,
    'F#9':11840,
    'G9':12544,
    'G#9':13290,
    'A9':14080,
    'A#9':14917,
    'B9':15804
}

MELODY = [
    (0, 'C6', 1, 21), (1, 'C#6', 1, 21), (2, 'D#6', 2, 21),
    (4, 'G#6', 2, 21), (6, 'C6', 1, 21), (7, 'C#6', 1, 21),
    (8, 'D#6', 1, 21), (9, 'G#6', 1, 21), (10, 'A#6', 1, 21),
    (11, 'C7', 1, 21), (12, 'A#6', 1, 21), (14, 'G#6', 2, 21),
    (16, 'D#6', 2, 21), (13, 'G6', 1, 21), (18, 'C6', 1, 21),
    (19, 'C#6', 1, 21), (20, 'D#6', 2, 21), (22, 'G#6', 2, 21),
    (24, 'A#6', 1, 21), (25, 'G6', 1, 21), (26, 'G#6', 1, 21),
    (27, 'A#6', 1, 21), (28, 'C#7', 1, 21), (29, 'C7', 1, 21),
    (30, 'C#7', 1, 21), (31, 'D#7', 1, 21), (32, 'D#6', 2, 21),
    (34, 'F6', 2, 21), (36, 'B5', 1, 21), (37, 'C6', 2, 21),
    (39, 'G#5', 1, 21), (40, 'B5', 1, 21), (41, 'A#5', 1, 21),
    (42, 'G#5', 2, 21), (44, 'G#5', 2, 21), (46, 'A#5', 2, 21),
    (48, 'B5', 2, 21), (50, 'B5', 1, 21), (51, 'A#5', 1, 21),
    (52, 'G#5', 1, 21), (53, 'A#5', 1, 21), (54, 'C6', 1, 21),
    (55, 'D#6', 1, 21), (56, 'F6', 1, 21), (57, 'C6', 1, 21),
    (58, 'D#6', 1, 21), (59, 'A#5', 1, 21), (60, 'C6', 1, 21),
    (61, 'G#5', 1, 21), (62, 'A#5', 1, 21), (63, 'G#5', 1, 21),
    (64, 'C6', 2, 21), (66, 'D#6', 2, 21), (68, 'F6', 1, 21),
    (69, 'C6', 1, 21), (70, 'D#6', 1, 21), (71, 'A#5', 1, 21),
    (72, 'C6', 1, 21), (73, 'G#5', 1, 21), (74, 'B5', 1, 21),
    (75, 'C6', 1, 21), (76, 'B5', 1, 21), (77, 'A#5', 1, 21),
    (78, 'G#5', 1, 21), (79, 'A#5', 1, 21), (80, 'B5', 2, 21),
    (82, 'G#5', 1, 21), (83, 'A#5', 1, 21), (84, 'C6', 1, 21),
    (85, 'D#6', 1, 21), (86, 'A#5', 1, 21), (87, 'B5', 1, 21),
    (88, 'A#5', 1, 21), (89, 'G#5', 1, 21), (90, 'A#5', 2, 21),
    (92, 'G#5', 2, 21), (94, 'A#5', 2, 21), (96, 'D#6', 2, 21),
    (98, 'F6', 2, 21), (100, 'B5', 1, 21), (101, 'C6', 2, 21),
    (103, 'G#5', 1, 21), (104, 'B5', 1, 21), (105, 'A#5', 1, 21),
    (106, 'G#5', 2, 21), (108, 'G#5', 2, 21), (110, 'A#5', 2, 21),
    (112, 'B5', 2, 21), (114, 'B5', 1, 21), (115, 'A#5', 1, 21),
    (116, 'G#5', 1, 21), (117, 'A#5', 1, 21), (118, 'C6', 1, 21),
    (119, 'D#6', 1, 21), (120, 'F6', 1, 21), (121, 'C6', 1, 21),
    (122, 'D#6', 1, 21), (123, 'A#5', 1, 21), (124, 'C6', 1, 21),
    (125, 'G#5', 1, 21), (126, 'A#5', 1, 21), (127, 'G#5', 1, 21),
    (128, 'C6', 2, 21), (130, 'D#6', 2, 21), (132, 'F6', 1, 21),
    (133, 'C6', 1, 21), (134, 'D#6', 1, 21), (135, 'A#5', 1, 21),
    (136, 'C6', 1, 21), (137, 'G#5', 1, 21), (138, 'B5', 1, 21),
    (139, 'C6', 1, 21), (140, 'B5', 1, 21), (141, 'A#5', 1, 21),
    (142, 'G#5', 1, 21), (143, 'A#5', 1, 21), (144, 'B5', 2, 21),
]

def play_tune(melody, tempo=2):
    for _, note, dur, _ in melody:
        if note == 'R':
            buzzer.duty_u16(0)
        else:
            buzzer.freq(NOTES[note])
            buzzer.duty_u16(32768)
        sleep(dur * tempo / 10)  # Slight slowdown for musicality
    buzzer.duty_u16(0)


while True:
    play_tune(MELODY, tempo=2)
    sleep(1)
